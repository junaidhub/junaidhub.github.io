<script>
  async function fetchText(url) {
    try {
      const res = await fetch(url);
      return await res.text();
    } catch (err) {
      return "⚠️ Failed to load file.";
    }
  }

  async function renderDashboard() {
    const res = await fetch('files.json');
    const data = await res.json();
    const dashboard = document.getElementById('dashboard');
    dashboard.innerHTML = '';

    for (const folder of data) {
      const section = document.createElement('section');
      section.innerHTML = `<h2 class="text-2xl font-semibold text-blue-600">${folder.folder}</h2>`;
      const grid = document.createElement('div');
      grid.className = "grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4";

      for (const file of folder.files) {
        const card = document.createElement('div');
        card.className = "card bg-white p-4 shadow rounded-xl";

        const title = `<p class="text-lg font-medium">${file.name}</p>`;
        const time = `<p class="text-sm text-gray-500">${new Date(file.updated).toLocaleString()}</p>`;
        
        let preview = "";

        if (file.type === 'txt' || file.type === 'csv') {
          const content = await fetchText(file.url);
          preview = `
            <pre class="bg-gray-100 text-sm p-2 mt-2 rounded overflow-auto max-h-48">${content}</pre>
          `;
        } else if (file.type.match(/(png|jpg|jpeg|gif)/)) {
          preview = `<img src="${file.url}" class="img-preview mt-2 rounded-lg max-h-32" />`;
        } else {
          preview = `<a href="${file.url}" download class="link text-sm mt-2 inline-block">⬇️ Download File</a>`;
        }

        card.innerHTML = title + time + preview;
        grid.appendChild(card);
      }

      section.appendChild(grid);
      dashboard.appendChild(section);
    }
  }

  renderDashboard();
  setInterval(() => location.reload(), 60000); // Auto-refresh every 60s
</script>
